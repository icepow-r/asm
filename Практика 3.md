# Практика 3 (17.09.2025)

## Создание и отладка программы в среде Fresh

В среде разработки **Fresh** создайте новый файл с исходным кодом на ассемблере, скомпилируйте программу (комбинация клавиш **Ctrl+F9**) и запустите её в отладчике **x64dbg** (комбинация клавиш **Shift+F8**). Исходный код программы приведён ниже:

```asm
format PE

entry Start

section '.data' data readable writeable
    a dd 0x12344321

section '.text' code readable executable

Start:
    mov eax, 0x12345678
    mov ebx, 0x87654321
    push ebx
    pop ecx
    mov edx, [a]
    mov [a], ebx
    ret
```

После выполнения задания отправьте в **личное сообщение** скриншот, на котором видна среда разработки **Fresh** и запущенный отладчик **x64dbg**. Если изображение не помещается на один скриншот, можно отправить несколько.

## Основное назначение отладчика

Отладчик используется для пошагового выполнения программы с отслеживанием изменений в регистрах, переменных, структурах или других объектах в процессе выполнения инструкций или фрагментов кода.

Если при отладке была нажата неверная клавиша или произошла ошибка, можно **перезапустить отладчик**, нажав **Ctrl+F2**, чтобы начать отладку заново.

## Пошаговая отладка

Пошаговое выполнение программы бывает двух видов:
1. **Без захода в функции** (внутренние или сторонние): нажмите клавишу **F8**.
2. **С заходом в функции**: нажмите клавишу **F7**.

### Задание на самопроверку
С помощью пошагового выполнения **без захода в функции** (клавиша **F8**) выполните **первую строку** программы в отладчике. Если всё сделано правильно, в правом верхнем углу отладчика содержимое регистра **eax** изменится на **0x12345678**, и это значение будет выделено красноватым цветом, указывающим на изменение регистра. Если результат отличается, отправьте скриншот в **личное сообщение**.

## Точки останова (брейкпоинты)

**Точка останова** — это механизм, позволяющий остановить выполнение программы на определённой инструкции. В отладчике **x64dbg** точка останова устанавливается и снимается нажатием клавиши **F2**.

### Задание на самопроверку
В активном отладчике с помощью клавиш **"стрелка вверх"** и **"стрелка вниз"** перейдите на инструкцию **push ebx**. Когда эта инструкция будет выделена серой полоской, нажмите **F2**. Если всё сделано правильно, слева от инструкции её адрес будет выделен красным. Если результат отличается, отправьте скриншот в **личное сообщение**.

### Задание на самопроверку
После установки брейкпоинта на инструкции **push ebx** нажмите **F9**. Если всё сделано правильно, выполнение программы остановится на этой инструкции, а в регистрах:
- **eax** будет содержать значение **0x12345678**,
- **ebx** будет содержать значение **0x87654321**.

Если результат отличается, отправьте скриншот в **личное сообщение**.

## Работа со стеком

В нижней правой части отладчика отображается содержимое стека. В начале выполнения программы на вершине стека обычно находится адрес возврата в системную библиотеку **KERNEL32.DLL**, что видно по подсказке, начинающейся с: *"возврат к kernel32.BaseThreadInitThunk ..."*.

### Задание на самопроверку
В отладчике выполните инструкцию **push ebx** с помощью клавиши **F8**. Если всё сделано правильно, в нижней правой части отладчика, **выше адреса возврата**, появится значение **0x87654321**. Если результат отличается, отправьте скриншот в **личное сообщение**.

### Задание на самопроверку
В отладчике выполните инструкцию **pop ecx** с помощью клавиши **F8**. Если всё сделано правильно, значение **0x87654321** исчезнет из стека, и на вершине стека снова будет адрес возврата с подсказкой. Если результат отличается, отправьте скриншот в **личное сообщение**.

## Работа с дампом памяти

В отладчике найдите строку:

```asm
mov edx, dword ptr [0x401000]
```

Щёлкните правой кнопкой мыши по значению **0x401000** в этой строке, в открывшемся меню выберите **"Перейти к дампу"** и затем выберите второй (нижний) пункт (**"Константа ..."**). В нижней левой части отладчика, во вкладке **"Дамп 1"**, отобразится содержимое оперативной памяти, начинающееся с **21 43 34 12**. Это соответствует значению 32-битной переменной **0x12344321**.

### Просмотр значений в формате Little Endian
Для удобного просмотра значений в формате **Little Endian**:
1. В окне дампа (**"Дамп 1"**) щёлкните правой кнопкой мыши.
2. В меню выберите **"Целое"** → **"Hex long (32 бита)"**.
3. В начале дампа появится значение переменной **a** — **0x12344321**.

### Возврат к стандартному виду дампа
Для возврата к стандартному виду дампа:
1. В окне дампа (**"Дамп 1"**) щёлкните правой кнопкой мыши.
2. В меню выберите **"Шестнадцатеричное"** → **"ASCII"**.