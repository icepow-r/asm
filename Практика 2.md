# 1. Общее (что делали на паре)

* Дата: 10.09.2025. Цель занятия ? подготовка рабочей среды для разработки и отладки простейших программ на ассемблере (Fresh IDE + FASM + внешний отладчик x64dbg), создание первого источника и его компиляция/запуск.&#x20;
* Итоговый практический результат ? создать asm-файл, скомпилировать (Ctrl+F9), найти .exe рядом с исходником и запустить его; запустить внешний отладчик через Shift+F8.&#x20;

# 2. Подготовка папок и общая организация

* Рекомендуемая рабочая папка (пример):
  `C:\AsmProjects` ? **все** исходники и сгенерированные exe сохранять сюда (каждая программа ? отдельная подпапка при необходимости).&#x20;
* Почему отдельная папка: порядок, удобство резервного копирования, избежание конфликтов прав доступа и лишних путей в отладчике.

# 3. Fresh IDE ? настройка внешнего вида и базовые действия

**Как включить тёмную тему (пошагово):**

1. Меню: `Options` ? `IDE options`.
2. Вкладка `Editor options` ? нажать `Load`. Выбрать файл темы (пример):
   `C:\Fresh\IDE\themes\TomorrowNight`.
3. В поле `Font:` справа нажать квадратик ? выбрать шрифт `Liberation Mono` или `Courier New`. Размер ? по вкусу. В поле ?набор символов? выбрать **Кириллица**.&#x20;

**Комментарий по шрифтам:** обязательно использовать **моноширинный** шрифт (каждый символ одинаковой ширины) ? это важно для читабельности кода и выравнивания колонок (табуляция, байты, комментарии). Примеры: `Liberation Mono`, `Courier New`. Иногда в системе бывает несколько версий `Liberation Mono` с разной отрисовкой символов ? если кто-то жалуется на ?странную букву Б?, попробуйте альтернативный моношрифт.&#x20;

# 4. Создание нового ASM-файла в Fresh (пошагово)

1. `File` ? `New...`
2. В открывшемся окне выбрать **Source file** ? `OK`.
3. **Сразу** сохранить файл (`File` ? `Save` или Ctrl+S) в рабочую папку (`C:\AsmProjects\?`). Это критично: многие ошибки (например, Write failed) происходят из-за незасохранённого файла.&#x20;

# 5. Пример кода, который вставляют как шаблон (и его разбор)

Вставить в новый файл следующий код (как на доске):

```asm
include '%fasminc%/win32ax.inc'

.code

start:

    invoke  MessageBox,HWND_DESKTOP,"May I introduce myself?",invoke GetCommandLine,MB_YESNO

    invoke  ExitProcess, 0

.end start
```

**Пояснения по строкам:**

* `include '%fasminc%/win32ax.inc'` ? подключение файла с макросами/обёртками для Win32 API (путь задаётся переменной `%fasminc%`, обычно настраивается при установке FASM). Это упрощает вызовы `invoke`.&#x20;
* `.code` ? секция кода.
* `start:` ? точка входа (метка).
* `invoke MessageBox, HWND_DESKTOP, "May I introduce myself?", invoke GetCommandLine, MB_YESNO` ? в транскрипте показан вложенный `invoke GetCommandLine` в параметрах `MessageBox`. Это транскрипционная запись лекции ? смысл: программа вызывает MessageBox (окно) с текстом и использует (или хотел показать) командную строку как подпись/параметр. Практически: часто сначала делают `invoke GetCommandLine` в отдельной строке и передают возвращённый указатель в `MessageBox`.
* `invoke ExitProcess, 0` ? выход из программы с кодом 0.&#x20;

> Совет: если компилятор/линкер жалуется ? сначала попробуй вызвать `GetCommandLine` отдельно и сохранить результат в регистр/переменную, а потом передать в `MessageBox`.

# 6. Компиляция и проверка результата

* **Скомпилировать:** в Fresh ? **Ctrl+F9**. Если всё успешно ? внизу IDE появится сообщение с синим значком `Compiled` и указанием количества байт (в примере лекции ? `1536` байт).&#x20;
* **Где появится exe:** в той же папке, где сохранён `.asm` (рядом с исходником появится `.exe`). Запустив его, увидишь окно MessageBox с кнопками `Yes`/`No`. Нажать любую из них, чтобы окно закрылось.&#x20;

# 7. Частые ошибки при компиляции и их решение

**Ошибка: `Error: Write failed!` при Ctrl+F9**
Что нужно сделать последовательно:

1. Проверь, сохранён ли исходный файл (Ctrl+S).
2. Закрой запущенную программу (если exe ещё открыт ? закрой окно MessageBox).
3. Закрой отладчик x64dbg (если он запущен).
   Пояснение: write failed часто случается если файл .exe занят процессом/отладчиком и FASM не может записать новый бинарник.&#x20;

**Ошибка: в x64dbg центральный адрес начинается с 7 (адрес вида `7xxxxxxx`), и отладчик показывает "неправильный" базовый адрес**
Порядок действий:

1. Сначала проверить настройки/галочки в x64dbg ? преподаватель дал скрин с правильными галочками (ссылку он прикреплял).&#x20;
2. Если настройки корректны, но адрес всё равно начинается с `7`, то **закрыть x64dbg** и **удалить две папки** (при выключенном отладчике):

   * `C:\x64dbg\release\x32\db`
   * `C:\x64dbg\release\x64\db`
     После этого перезапустить x64dbg (это ?лечит? баг с неверными DB/кэшами).&#x20;

# 8. Запуск внешнего отладчика x64dbg из Fresh

* Для запуска скомпилированной программы в **внешнем отладчике x64dbg** ? нажать **Shift+F8** в Fresh. Это автоматически откроет x64dbg и загрузит exe.&#x20;
* В x64dbg можно менять тему: `Параметры` ? `Тема` ? `Dark`.&#x20;

**Важные UI-места в x64dbg (на что обратить внимание):**

* Средняя колонка ? **адреса**; преподаватель обращал внимание, что адрес выделяется цветом (у кого тёмная/светлая тема ? немного по-разному виден) ? это основной ориентир, чтобы понимать, где расположена кодовая страница. При проблемах с адресами ? следовать пункту удаления папок DB.&#x20;

# 9. Практическая заметка по работе со скриншотами (задание преподавателя)

* Задание: отправить **в личное сообщение** преподавателю скрин(ы) с:

  1. Fresh IDE с исходным кодом (код должен быть виден).
  2. Запущенный x64dbg (должны быть видны основные окна: дизассемблер/регистры/память).
* Если всё не помещается ? разрешено несколько скриншотов. Преподаватель просил, чтобы среда разработки была **на весь экран**, чтобы код читался.&#x20;

# 10. Совет по отладке (что НЕ трогать пока)

* На текущей паре преподаватель просил **не лезть глубоко в отладчик** ? пока что учимся **запускать** x64dbg и настраивать окружение; пошаговая отладка и управление execution flow (breakpoints, stepping, bp on address/conditional breakpoints) будут на следующей паре. Пока лучше не менять неизвестные опции в x64dbg: можно только настраивать тему и смотреть окно адресов.&#x20;

# 11. Частые замечания/?провалы? студентов (из стенограммы) ? и как их избежать

* **Не сохраняют файл сразу** ? => Write failed. Решение: сохраняй всегда сразу после создания нового файла.&#x20;
* **Запускают exe и не закрывают окно** (тогда FASM не может перезаписать exe). Решение: после запуска нажать Yes/No (закрыть) перед компиляцией.&#x20;
* **Неправильные галочки в x64dbg** ? преподаватель просил сверить с предоставленным скрином; часто проблемы решаются простой корректной настройкой.&#x20;
* **Не разворачивают Fresh IDE на весь экран** ? преподаватель просит именно так, чтобы код был читабелен на скриншотах.&#x20;

# 12. Подробный чек-лист (шпаргалка) ? распечатай/скопируй

1. **Создать папку проекта:**
   `C:\AsmProjects\MyProg\`

2. **В Fresh IDE:**

   * `File ? New... ? Source file` ? `OK`
   * `File ? Save` (Ctrl+S) ? сохранить как `C:\AsmProjects\MyProg\main.asm`.&#x20;

3. **Вставить код**, сохранить.

4. **Скомпилировать:** `Ctrl+F9`.

   * Ожидаемый результат: внизу ? `Compiled` + N байт (в примере 1536). Если `Error: Write failed!` ? выполнить пункты из раздела 7.&#x20;

5. **Запустить отладчик:** `Shift+F8` ? откроется x64dbg. Проверь видимы ли адреса и код.

6. **Если в x64dbg в адресной колонке видна цифра `7` в начале** ? проверить галочки; если галочки правильные ? закрыть x64dbg и удалить `C:\x64dbg\release\x32\db` и `C:\x64dbg\release\x64\db`. Затем перезапустить.&#x20;

7. **Сделать скриншоты**: Fresh IDE (полный экран, код виден) + x64dbg (дизассемблер/регистры). Отправить преподавателю в личное сообщение.&#x20;

# 13. Небольшая справка по горячим клавишам (кратко)

* `Ctrl+S` ? сохранить файл.
* `Ctrl+F9` ? компиляция в Fresh.
* `Shift+F8` ? запустить внешний отладчик x64dbg из Fresh.&#x20;

# 14. Совет по корректировке шаблонного кода (практическая ремарка)

* Если наблюдаешь синтаксические/логические проблемы с прямым вложением `invoke GetCommandLine` в список параметров `MessageBox`, сделай так (практичная последовательность):

  1. `invoke GetCommandLine` ? результат окажется в `eax` (или как возвращаемое значение ? завиcит от макросов/конвенции).
  2. `invoke MessageBox, HWND_DESKTOP, "May I introduce myself?", eax, MB_YESNO`
     (точный регистр/передача зависит от используемого include/win32ax.inc ? тщательно посмотри документацию того include).
* Почему: явное получение и использование результата упрощает отладку и убирает неочевидные вложенности. (Это техническая рекомендация ? исходный пример был взят прямо с доски).&#x20;