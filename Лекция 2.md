## Введение в программирование на ассемблере для архитектуры x86

Лекция посвящена изучению основ программирования на языке ассемблера для архитектуры x86. В следующем семестре студенты приступят к дисциплине, связанной с корневым программированием, где будет освоено использование Windows API и разработка драйверов. Лектор обращает внимание на решение проблемы отсутствия лицензии на операционную систему Windows, предлагая альтернативу в виде бесплатной операционной системы ReactOS. Эта система представляет собой клон Windows с открытым исходным кодом и подходит для текущего курса по ассемблеру, а также для следующего семестра. ReactOS легко устанавливается и демонстрирует стабильную работу для нужд курса, хотя иногда может быть нестабильной. В случае проблем с функциональностью программного обеспечения лектор готов оказать помощь, основываясь на собственном опыте использования системы в рамках дисциплины низкоуровневого программирования.

## Обзор архитектуры x86 и её особенностей

Архитектура процессора представляет собой совокупность принципов, элементов и структур, лежащих в основе устройства и функционирования процессора. Это определение не претендует на полноту, так как понятие архитектуры процессора вызывает множество споров. В рамках курса изучается программирование на ассемблере для архитектуры x86, которая является наиболее распространённой, хотя в контексте смартфонов архитектура ARM может составлять конкуренцию. Архитектура x86 имеет значительные недостатки, один из которых связан с хранением адреса возврата из функции на вершине стека, что приводит к уязвимостям переполнения буфера. Эти уязвимости позволяют выполнять произвольный код с привилегиями уязвимой программы. Исправление этой проблемы невозможно из-за необходимости поддерживать обратную совместимость с ранними процессорами. История создания x86 уходит корнями в разработки Intel для процессоров калькуляторов, что объясняет её простоту и недочёты. Когда IBM в конце 1970-х годов решила выйти на рынок персональных компьютеров, Intel использовала свои наработки, создав архитектуру x86. Первоначально персональные компьютеры воспринимались как дорогие игрушки, и никто не предвидел их массовое распространение. Позже, когда рынок вырос, совместимость стала приоритетом, сохраняя проблемы архитектуры.

## История и эволюция архитектуры x86

Название x86 произошло от первого процессора Intel 8086, где цифра 80 со временем опустилась в разговорной речи, оставив только 86. Последующие процессоры (186, 286, 386) закрепили это наименование, а буква X обозначает пропущенную первую цифру. Современные процессоры, включая 64-битные от AMD, сохраняют совместимость с ранними моделями, что является ключевой особенностью x86. Попытка Intel в 1990-х годах создать новую архитектуру Itanium, свободную от недостатков x86, провалилась из-за отсутствия совместимости. Itanium, будучи 64-битной архитектурой, не получила популярности, и проект был закрыт. Этот случай стал уроком для Intel, показав, что модификация устоявшегося продукта с большим числом пользователей крайне затруднительна. Аналогичные проблемы отмечены в попытках Microsoft исправлять ошибки, что также приводило к значительным трудностям.

## Регистры процессора: общие принципы

Регистр процессора — это ячейка памяти, являющаяся составной частью процессора, и он не является оперативной памятью, что важно учитывать. Количество регистров фиксировано и не может быть изменено, в отличие от оперативной памяти, объём которой регулируется установкой или удалением планок. Скорость доступа к регистрам значительно превышает скорость доступа к оперативной памяти из-за разницы в физическом расположении: регистры находятся внутри процессора, а оперативная память — на материнской плате. Для наглядности оперативную память сравнивают с черепахой, а регистры — с сверхзвуковым истребителем. Кэш-процессора, также являющийся частью процессора, ускоряет доступ к данным, храня часто используемую информацию из оперативной памяти. Технология спекулятивного выполнения кода позволяет предугадывать переходы в машинном коде и выполнять их заранее, сохраняя результаты в кэше. Однако эта технология ранее вызвала уязвимости, позволявшие извлекать конфиденциальные данные, и её отключение снизило производительность процессоров.

## Регистры общего назначения в архитектуре x86

Регистры общего назначения не имеют специфического назначения и используются для хранения операндов и результатов выполнения машинных инструкций. В 32-битной версии архитектуры x86 выделяются следующие регистры: EAX, EBX, ECX, EDX, ESP, EBP, EDI, ESI и EFLAGS. Имена регистров существуют только на уровне ассемблера; в машинном коде они нумеруются. Регистр EFLAGS считается фантомным, так как недоступен напрямую, и его состояние определяется отдельными битами. Структура регистра EAX иллюстрирует устройство остальных: он делится на 16-битный регистр AX, который, в свою очередь, включает 8-битные регистры AH и AL. Старшая 16-битная часть EAX безымянна, но доступна через побитовые сдвиги. Регистры EBX, ECX и EDX аналогичны по структуре, отличаясь только буквой после E. Регистры ESP и EBP делятся только на 16-битные части (SP и BP соответственно), не имея 8-битных подрегистров. В 64-битной версии регистры, такие как RAX, включают 32-битный EAX как младшую часть, сохраняя иерархическую структуру.

## Регистр флагов и сегментные регистры

Регистр флагов (EFLAGS в 32-битной версии, RFLAGS в 64-битной) хранит состояние битов, отражающих особенности работы процессора и результаты инструкций. Прямой доступ к нему невозможен; значимы только отдельные биты, которые можно анализировать или изменять. Сегментные регистры (всего шесть, размером 16 бит) имели важное значение в реальном режиме работы процессора, таком как у Intel 8086, где память делилась на сегменты по 64 килобайта. Адресация включала сегмент и смещение, позволяя использовать до 1 мегабайта памяти. В современном защищённом режиме сегментные регистры утратили актуальность, за исключением FS и GS, которые сохраняют значение. Реальный режим изучаться не будет, но интересующиеся могут обратиться к литературе по MS-DOS.